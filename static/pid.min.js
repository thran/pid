/*! plant-challenge-libs 2016-04-14 */
var app=angular.module("pid",["ngFileUpload"]);app.controller("pid",["$scope","$http","Upload",function(a,b,c){a.$watch("files",function(){a.files&&null!==a.files&&a.files.length>0&&a.upload(a.files)}),b.get("/classes").success(function(b){a.classes=b}),navigator.geolocation&&(navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){a.lat=b.coords.latitude,a.lng=b.coords.longitude})}),a.week=(new Date).getWeekNumber()),a.upload=function(b){a.images=null,a.error=null,a.loading=!0,c.upload({url:"/identify",data:{files:b,lat:a.lat,lng:a.lng,week:a.week}}).then(function(b){a.images=[],a.loading=!1,b.data.error?a.error=b.data.error:(angular.forEach(b.data.images,function(b){var c={results:[],raw_predictions:[],certainties:b.certainties};angular.forEach(b.plants,function(a,b){c.results.push({"class":b,probability:a})}),angular.forEach(b.raw_predictions,function(a,b){c.raw_predictions.push({"class":b,probability:a})}),a.images.push(c)}),a.suggestions=[],angular.forEach(b.data.suggestions,function(b,c){a.suggestions.push({"class":c,probability:b})}))},function(b){a.loading=!1,a.error="Something went wrong."})}}]),Date.prototype.getWeekNumber=function(){var a=new Date(+this);return a.setHours(0,0,0),a.setDate(a.getDate()+4-(a.getDay()||7)),Math.ceil(((a-new Date(a.getFullYear(),0,1))/864e5+1)/7)};