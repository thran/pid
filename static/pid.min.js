/*! plant-challenge-libs 2016-03-30 */
var app=angular.module("pid",["ngFileUpload"]);app.controller("pid",["$scope","$http","Upload",function(a,b,c){a.$watch("file",function(){a.file&&null!==a.file&&a.upload(a.file)}),b.get("/classes").success(function(b){a.classes=b}),navigator.geolocation&&(navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){a.lat=b.coords.latitude,a.lng=b.coords.longitude})}),a.week=(new Date).getWeekNumber()),a.upload=function(b){a.results=null,a.error=null,a.loading=!0,c.upload({url:"/identify",data:{file:b,lat:a.lat,lng:a.lng,week:a.week}}).then(function(b){a.results=[],a.loading=!1,b.data.error?a.error=b.data.error:angular.forEach(b.data,function(b,c){a.results.push({"class":c,probability:b})})},function(b){a.loading=!1,a.error="Something went wrong."})}}]),Date.prototype.getWeekNumber=function(){var a=new Date(+this);return a.setHours(0,0,0),a.setDate(a.getDate()+4-(a.getDay()||7)),Math.ceil(((a-new Date(a.getFullYear(),0,1))/864e5+1)/7)};